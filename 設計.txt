開発ができたら修正します。

RPGクエストシステム設計書

1. アーキテクチャ設計

1.1 概要

RPGクエストシステムは、Minecraftのプラグインとして実装され、プレイヤーがクエストを受注・達成することでランクアップし、報酬を得ることができるシステムです。このシステムは、主に以下のコンポーネントで構成されます。

メインプラグインクラス
コマンド
マネージャークラス
データモデル

1.2 メインプラグインクラス

プラグインの起動・停止処理
コマンドの登録

1.3 コマンド

ゲームが開始できるコマンド
現在のクエストの確認をするコマンド
個別のNPCを召喚するコマンド
召喚したNPCを消去するコマンド

1.4 マネージャークラス

クエストの管理
NPCの管理

1.5 イベント

各コマンド内で処理を書く

1.6 データモデル

クエストデータを表現するモデル

2. クラス設計

2.1 Mainクラス

プラグインのエントリーポイント
コマンドの登録メソッド

2.2 コマンド

BaseCommand: コマンドの基底クラス
GameStart: ゲームが開始できるコマンド
QuestStatus: 現在のクエストの確認をするコマンド
VisitNpc: 個別のNPCを召喚するコマンド
LetsGoAdventure: 召喚したNPCを消去するコマンド

2.3 マネージャークラス

QuestManager: クエストの管理を行う
NPCManager: NPCの管理を行う（使用するか検討中）

2.4 イベント

各コマンド内で処理を書く

2.5 データモデル

Quest: クエストのデータモデル

3. 処理フロー設計

3.1 ゲーム開始時

プレイヤーがゲーム開始コマンドを入力
メインプラグインクラスがコマンドを受け取り、プレイヤーの付近に3体のNPCをスポーン

3.2 クエスト受注

プレイヤーがクエスト受注NPCに話しかける

インベントリGUIが開き、54つのクエストリストが表示される
(インベントリGUIに、プレイヤーが現在受注可能なクエストがリストアップされます。
各クエストには「新規受注可能」または「進行中」または「ランクが足りません」のステータスが表示され、
「新規受注可能」のクエストだけが選択可能にします。)

クエスト受注制限のチェックをします。
プレイヤーが同時に進行可能なクエストの数は最大で3つまでに制限されています。
プレイヤーが既に3つのクエストを進行中の場合、新たなクエストは受注できないとする。
クエスト受注画面で、プレイヤーが現在進行中のクエスト数が表示され、
上限に達している場合は、警告メッセージが表示されます。

クールタイムの設定をします。
クエストがクリアされた場合やキャンセルをされた場合、そのクエストの再受注にはクールタイムが設定されます。
このクールタイムの期間中、同じクエストを再度受注することはできません。
クールタイムが経過すると、再びそのクエストが「新規受注可能」としてリストに表示されます。

プレイヤーがクエストを選択
クエストの詳細と報酬の内容が表示され、「クエストを受ける」ボタンが表示されます。
プレイヤーがこのボタンをクリックすると、クエストを受注します。
クエストを受注した後、プレイヤーのインベントリに「クエスト受注書」アイテムが追加されます。
このアイテムは、クエストの進行や提出に必要なアイテムです。
クエストの受注が完了したことがプレイヤーに通知され、クエストの進行が開始されます。

3.3 クエスト提出

プレイヤーがクエスト提出NPCに話しかける

インベントリGUIが開き、提出可能なクエストリストが表示される
(インベントリGUIに、プレイヤーが進行中のクエストがリストアップされます。
各クエストには「提出可能」または「進行中」のステータスが表示され、
「提出可能」のクエストだけが選択可能にする。)

プレイヤーがクエストリストから提出したいクエストを選択します。
クエスト提出用のアイテムが揃っているかをチェックします。提出アイテムは、プレイヤーのインベントリにある必要があります。

クエストアイテムと「クエスト受注書」の内容が一致するか確認をする
(提出されたアイテムと受注時に指定されたアイテムが一致するかを確認します。
この判定は、アイテムの種類や数などの条件が含まれる。)
アイテムが一致した場合、クエストは完了として処理され、プレイヤーに報酬が与えられます。
一致しない場合は「クエストがまだ終わっていません」とプレイヤーにメッセージを表示する。
また、プレイヤーのクエスト進行状況が更新されます。そしてランクアップ条件が満たされたらランクをアップさせる。(自分のランク帯のクエストクリアが2回達成すること)
クエスト完了に伴い、プレイヤーのインベントリから提出アイテムが削除されます。
GUIが閉じた後、プレイヤーにクエスト完了のメッセージが表示されます。

3.4 アイテム販売

プレイヤーがアイテム販売NPCに話しかける

インベントリGUIが開き、購入可能なアイテムリストが表示される、
インベントリGUIに、プレイヤーが購入可能なアイテムがリストアップされます。

各アイテムには「購入可能」または「ロック中」のステータスが表示され、「購入可能」のアイテムだけが選択可能です。
プレイヤーがアイテムリストから購入したいアイテムを選択します。

アイテム購入確認画面の表示され、アイテムの詳細と必要な通貨（ネザースターなど）の情報が表示され、
「アイテムを買う」ボタンが表示されます。プレイヤーがこのボタンをクリックすると、アイテムの購入が完了します。
購入が完了すると、指定された通貨がプレイヤーのインベントリから引き落とされ、購入したアイテムがインベントリに追加されます。
アイテム取引後、アイテムの購入が完了したことがプレイヤーに通知されます。

3.5 クエスト進行状況確認

プレイヤーが進行状況確認コマンドを入力

インベントリGUIが開き、現在進行中のクエストリストが表示される。
インベントリGUIに、プレイヤーが現在進行中のクエストがリストアップされます。
各クエストには「進行中」または「キャンセル可能」のステータスが表示されます。
プレイヤーが進行中のクエストを選択すると、クエストの詳細や達成時に得られる報酬のプレビューが表示されます。

クエスト詳細画面で、プレイヤーが現在進行中のクエストをキャンセルするオプションが提供されます。
プレイヤーがクエストキャンセルを選択すると、そのクエストがキャンセルされます。
クエストをキャンセルした場合、そのクエストの再受注にはクールダウンタイムが発生します。このクールダウンタイムの残り時間が表示されます。
クールダウンが経過すると、そのクエストが再度「新規受注可能」としてリストに表示されます。
プレイヤーの現在のランクが、クエストの進行状況と共に表示されます。

3.6 NPC召喚

プレイヤーがNPC召喚コマンドを入力
指定されたタイプのNPCがプレイヤーの近くにスポーン

3.7 NPC削除

プレイヤーがNPC削除コマンドを入力
プレイヤーが召喚したNPCを削除する。

4. テスト設計

4.1 ユニットテスト

各コマンドハンドラのテスト
各マネージャークラスのロジックのテスト

4.2 インテグレーションテスト

コマンド実行後の全体的な動作確認
クエストの受注、提出、進行状況の表示のシナリオテスト

5. 非機能要件

5.1 拡張性・保守性の考慮

クエストやNPCの追加・変更が容易であること
外部設定ファイルでクエストやNPCの設定を行う

5.2 パフォーマンス

コマンドやイベントハグンドリンのレスポンスが迅速であること

5.3 NPCの個別召喚

任意の場所でNPCを召喚するためのコマンドを実装する

5.4 NPCの削除

召喚したNPCを削除するコマンドを実装する

6. その他の要件

6.1 クエスト管理のルール

プレイヤーのランクより低いクエストではランクアップできない
クエスト達成でネザースターを報酬として提供
ネザースターでアイテムを購入可能

6.2 インターフェース

ゲーム開始コマンドでNPCをスポーン
クエストの進行状況の表示と進行中のクエストをキャンセルと報酬のプレビュー
クエスト受注制限（同時進行可能なクエスト数の上限は3つにすること、クールタイムの設定はクエストがクリアされた時にすること）
